<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Function to apply meteorological normalisation — buildMod • deweather</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Function to apply meteorological normalisation — buildMod"><meta name="description" content="This is the main function to apply a gbm::gbm() model to a data set."><meta property="og:description" content="This is the main function to apply a gbm::gbm() model to a data set."><meta property="og:image" content="https://davidcarslaw.github.io/deweather/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">deweather</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.7.2.9102</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/deweather.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://bookdown.org/david_carslaw/openair/">Book (External)</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-case-studies-external-" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Case Studies (External)</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-case-studies-external-"><li><a class="external-link dropdown-item" href="https://www.sciencedirect.com/science/article/pii/S004896971834244X">(2019) Using meteorological normalisation to detect interventions in air quality time series</a></li>
    <li><a class="external-link dropdown-item" href="https://www.sciencedirect.com/science/article/abs/pii/S1352231012001355">(2012) A short-term intervention study — Impact of airport closure due to the eruption of Eyjafjallajökull on near-field air quality</a></li>
    <li><a class="external-link dropdown-item" href="https://www.sciencedirect.com/science/article/abs/pii/S1352231009003069">(2009) Analysis of air pollution data at a mixed source location using boosted regression trees</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/davidcarslaw/deweather/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Function to apply meteorological normalisation</h1>
      <small class="dont-index">Source: <a href="https://github.com/davidcarslaw/deweather/blob/master/R/buildMod.R" class="external-link"><code>R/buildMod.R</code></a></small>
      <div class="d-none name"><code>buildMod.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This is the main function to apply a <code><a href="https://rdrr.io/pkg/gbm/man/gbm.html" class="external-link">gbm::gbm()</a></code> model to a data set.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">buildMod</span><span class="op">(</span></span>
<span>  <span class="va">input_data</span>,</span>
<span>  vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"trend"</span>, <span class="st">"ws"</span>, <span class="st">"wd"</span>, <span class="st">"hour"</span>, <span class="st">"weekday"</span>, <span class="st">"air_temp"</span><span class="op">)</span>,</span>
<span>  pollutant <span class="op">=</span> <span class="st">"nox"</span>,</span>
<span>  sam.size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">input_data</span><span class="op">)</span>,</span>
<span>  n.trees <span class="op">=</span> <span class="fl">200</span>,</span>
<span>  shrinkage <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  interaction.depth <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  bag.fraction <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  n.minobsinnode <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  cv.folds <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  simulate <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  B <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  n.core <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">123</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-input-data">input_data<a class="anchor" aria-label="anchor" href="#arg-input-data"></a></dt>
<dd><p>Data frame to analyse. Must contain a POSIXct field called
<code>date</code>.</p></dd>


<dt id="arg-vars">vars<a class="anchor" aria-label="anchor" href="#arg-vars"></a></dt>
<dd><p>Explanatory variables to use. These variables will be used to
build the <code><a href="https://rdrr.io/pkg/gbm/man/gbm.html" class="external-link">gbm::gbm()</a></code> model. Note that the model must include a trend
component. Several variables can be automatically calculated (see
<code><a href="prepData.html">prepData()</a></code> for details).</p></dd>


<dt id="arg-pollutant">pollutant<a class="anchor" aria-label="anchor" href="#arg-pollutant"></a></dt>
<dd><p>The name of the variable to apply meteorological
normalisation to.</p></dd>


<dt id="arg-sam-size">sam.size<a class="anchor" aria-label="anchor" href="#arg-sam-size"></a></dt>
<dd><p>The number of random samples to extract from the data for
model building. While it is possible to use the full data set, for data
sets spanning years the model building can take a very long time to run.
Additionally, there will be diminishing returns in terms of model accuracy.
If <code>sam.size</code> is greater than the number of number of rows of data, the
number of rows of data is used instead.</p></dd>


<dt id="arg-n-trees">n.trees<a class="anchor" aria-label="anchor" href="#arg-n-trees"></a></dt>
<dd><p>Number of trees to fit.</p></dd>


<dt id="arg-shrinkage">shrinkage<a class="anchor" aria-label="anchor" href="#arg-shrinkage"></a></dt>
<dd><p>A shrinkage parameter applied to each tree in the expansion.
Also known as the learning rate or step-size reduction; <code>0.001</code> to <code>0.1</code>
usually work, but a smaller learning rate typically requires more trees.
Default is <code>0.1</code>.</p></dd>


<dt id="arg-interaction-depth">interaction.depth<a class="anchor" aria-label="anchor" href="#arg-interaction-depth"></a></dt>
<dd><p>Integer specifying the maximum depth of each tree
(i.e., the highest level of variable interactions allowed). A value of <code>1</code>
implies an additive model, a value of <code>2</code> implies a model with up to 2-way
interactions, etc. Default is <code>5</code>.</p></dd>


<dt id="arg-bag-fraction">bag.fraction<a class="anchor" aria-label="anchor" href="#arg-bag-fraction"></a></dt>
<dd><p>The fraction of the training set observations randomly
selected to propose the next tree in the expansion. This introduces
randomness into the model fit. If <code>bag.fraction &lt; 1</code> then running the same
model twice will result in similar but different.</p></dd>


<dt id="arg-n-minobsinnode">n.minobsinnode<a class="anchor" aria-label="anchor" href="#arg-n-minobsinnode"></a></dt>
<dd><p>Integer specifying the minimum number of observations
in the terminal nodes of the trees. Note that this is the actual number of
observations, not the total weight.</p></dd>


<dt id="arg-cv-folds">cv.folds<a class="anchor" aria-label="anchor" href="#arg-cv-folds"></a></dt>
<dd><p>Number of cross-validation folds to perform. If <code>cv.folds &gt; 1</code> then <code><a href="https://rdrr.io/pkg/gbm/man/gbm.html" class="external-link">gbm::gbm()</a></code>, in addition to the usual fit, will perform a
cross-validation, calculate an estimate of generalization error returned in
<code>cv.error</code>.</p></dd>


<dt id="arg-simulate">simulate<a class="anchor" aria-label="anchor" href="#arg-simulate"></a></dt>
<dd><p>Should the original time series be randomly sampled with
replacement? The default is <code>FALSE</code>. Setting <code>simulate = TRUE</code> can be
useful for estimating model uncertainties. In which case models should be
run multiple times with <code>B = 1</code> and a different value of <code>seed</code> e.g. <code>seed = runif(1)</code>.</p></dd>


<dt id="arg-b">B<a class="anchor" aria-label="anchor" href="#arg-b"></a></dt>
<dd><p>Number of bootstrap simulations for partial dependence plots.</p></dd>


<dt id="arg-n-core">n.core<a class="anchor" aria-label="anchor" href="#arg-n-core"></a></dt>
<dd><p>Number of cores to use for parallel processing.</p></dd>


<dt id="arg-seed">seed<a class="anchor" aria-label="anchor" href="#arg-seed"></a></dt>
<dd><p>Random number seed for reproducibility in returned model.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Returns a list including the model, influence data frame and partial
dependence data frame.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="testMod.html">testMod()</a></code> for testing models before they are built.</p>
<p><code><a href="metSim.html">metSim()</a></code> for using a built model with meteorological simulations.</p>
<p><code><a href="plot2Way.html">plot2Way()</a></code>, <code><a href="plotInfluence.html">plotInfluence()</a></code> and <code><a href="plotPD.html">plotPD()</a></code> for visualising built
models.</p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>David Carslaw</p>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by David Carslaw.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

